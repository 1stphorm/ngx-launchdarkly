{"version":3,"file":"ngx-launchdarkly.js.map","sources":["ng://ngx-launchdarkly/lib/ngx-launchdarkly.service.ts","ng://ngx-launchdarkly/lib/ngx-launchdarkly.directive.ts","ng://ngx-launchdarkly/lib/ngx-launchdarkly.module.ts"],"sourcesContent":["import { Injectable, Inject, Optional } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { LDClient, LDFlagSet, LDOptions } from 'launchdarkly-js-client-sdk';\n\nexport const LAUNCH_DARKLY_INITIALIZER = 'LAUNCH_DARKLY_INITIALIZER';\nexport const LAUNCH_DARKLY_API_KEY = 'LAUNCH_DARKLY_API_KEY';\nexport const LAUNCH_DARKLY_OPTIONS = 'LAUNCH_DARKLY_OPTIONS';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LaunchDarklyService {\n  private _ldClient: LDClient;\n  private _flags: LDFlagSet;\n\n  readonly flagChange: Subject<any> = new Subject<any>();\n\n  private _setFlags(flags: any) {\n    this._flags = flags;\n    this.flagChange.next(this._flags);\n  }\n\n  constructor(\n    @Inject(LAUNCH_DARKLY_INITIALIZER) ldInitializer: Function,\n    @Inject(LAUNCH_DARKLY_API_KEY) ldClientApiKey: string,\n    @Optional() @Inject(LAUNCH_DARKLY_OPTIONS) ldOptions: LDOptions | undefined\n  ) {\n    this._flags = {};\n    this._ldClient = ldInitializer(ldClientApiKey, {\n      key: 'anon',\n      anonymous: true\n    }, ldOptions);\n\n    this._ldClient.on('initialized', (value) => this._setFlags(value));\n\n    this._ldClient.on('change', (value) => this._setFlags(value));\n\n    this._ldClient.on('error', (error) => this.flagChange.error(error));\n  }\n\n  changeUser(user: string) {\n    const currentUser = this._ldClient.getUser();\n\n    if (currentUser && currentUser.key !== user) {\n      if (user !== 'Anonymous') {\n        this._ldClient.identify({ key: user, name: user, anonymous: false });\n      } else {\n        this._ldClient.identify({ key: 'anon', anonymous: true });\n      }\n    }\n  }\n}\n","import {\n  Directive,\n  ViewContainerRef,\n  TemplateRef,\n  EmbeddedViewRef,\n  Input,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { LaunchDarklyService } from './ngx-launchdarkly.service';\n\nexport class NgxLaunchDarklyContext {\n  public $implicit: any = null;\n  public ngxLanchDarkly: any = null;\n}\n\n@Directive({\n  selector: '[ngxLaunchDarkly]'\n})\nexport class NgxLaunchDarklyDirective implements OnDestroy {\n  private _context: NgxLaunchDarklyContext = new NgxLaunchDarklyContext();\n  private _thenTemplateRef: TemplateRef<NgxLaunchDarklyContext> | null = null;\n  private _thenViewRef: EmbeddedViewRef<NgxLaunchDarklyContext> | null = null;\n\n  private _currentFlag: string | undefined;\n  private _flagSubscription: Subscription = Subscription.EMPTY;\n\n  constructor(\n    private _viewContainer: ViewContainerRef,\n    private _ldService: LaunchDarklyService,\n    templateRef: TemplateRef<NgxLaunchDarklyContext>\n  ) {\n    this._thenTemplateRef = templateRef;\n  }\n\n  @Input()\n  set ngxLaunchDarkly(flagName: string) {\n    if (this._currentFlag == null && flagName) {\n      this._currentFlag = flagName;\n      this._startSubscription();\n    } else {\n      throw new Error('flagName parameter should be bound once');\n    }\n  }\n\n  private _updateView() {\n    if (this._context.$implicit) {\n      if (!this._thenViewRef) {\n        this._viewContainer.clear();\n        if (this._thenTemplateRef) {\n          this._thenViewRef =\n            this._viewContainer.createEmbeddedView(this._thenTemplateRef, this._context);\n        }\n      }\n    } else {\n      this._viewContainer.clear();\n      this._thenViewRef = null;\n    }\n  }\n\n  private _startSubscription() {\n    this._flagSubscription = this._ldService.flagChange\n      .pipe(map(flags => !!flags[this._currentFlag]))\n      .subscribe((flagState: boolean) => {\n        this._context.$implicit = this._context.ngxLanchDarkly = flagState;\n        this._updateView();\n      });\n  }\n\n  ngOnDestroy() {\n    this._flagSubscription.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { NgxLaunchDarklyDirective } from './ngx-launchdarkly.directive';\nimport { LAUNCH_DARKLY_INITIALIZER } from './ngx-launchdarkly.service';\nimport { initialize } from 'launchdarkly-js-client-sdk';\n\n@NgModule({\n  declarations: [NgxLaunchDarklyDirective],\n  imports: [\n  ],\n  providers: [\n    { provide: LAUNCH_DARKLY_INITIALIZER, useValue: initialize }\n  ],\n  exports: [NgxLaunchDarklyDirective]\n})\nexport class NgxLaunchDarklyModule { }\n"],"names":[],"mappings":"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"}
